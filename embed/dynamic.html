<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Data Formulator embedded dynamically</title>
</head>

<body>
    <script>
        const table = [
            {
                "manufacturer": "Toyota",
                "model": "Corolla",
                "year": 2019,
                "price": 20000,
                "sale_date": "2023-01-15",
                "region": "West"
            },
            {
                "manufacturer": "Toyota",
                "model": "Camry",
                "year": 2020,
                "price": 25000,
                "sale_date": "2023-02-12",
                "region": "East"
            },
            {
                "manufacturer": "Toyota",
                "model": "RAV4",
                "year": 2021,
                "price": 30000,
                "sale_date": "2023-03-08",
                "region": "North"
            },
            {
                "manufacturer": "Toyota",
                "model": "Highlander",
                "year": 2022,
                "price": 35000,
                "sale_date": "2023-04-22",
                "region": "South"
            },
            {
                "manufacturer": "Toyota",
                "model": "4Runner",
                "year": 2020,
                "price": 40000,
                "sale_date": "2023-05-10",
                "region": "West"
            },
            {
                "manufacturer": "Ford",
                "model": "Fusion",
                "year": 2019,
                "price": 22000,
                "sale_date": "2023-06-18",
                "region": "East"
            },
            {
                "manufacturer": "Ford",
                "model": "Focus",
                "year": 2020,
                "price": 25000,
                "sale_date": "2023-07-05",
                "region": "North"
            },
            {
                "manufacturer": "Ford",
                "model": "Escape",
                "year": 2021,
                "price": 32000,
                "sale_date": "2023-08-14",
                "region": "South"
            },
            {
                "manufacturer": "Ford",
                "model": "Explorer",
                "year": 2022,
                "price": 38000,
                "sale_date": "2023-09-30",
                "region": "West"
            },
            {
                "manufacturer": "Ford",
                "model": "Expedition",
                "year": 2021,
                "price": 42000,
                "sale_date": "2023-10-25",
                "region": "East"
            },
            {
                "manufacturer": "Honda",
                "model": "Civic",
                "year": 2020,
                "price": 21000,
                "sale_date": "2023-11-12",
                "region": "North"
            },
            {
                "manufacturer": "Honda",
                "model": "Accord",
                "year": 2021,
                "price": 28000,
                "sale_date": "2023-12-03",
                "region": "South"
            },
            {
                "manufacturer": "Honda",
                "model": "CR-V",
                "year": 2022,
                "price": 33000,
                "sale_date": "2023-01-28",
                "region": "West"
            },
            {
                "manufacturer": "Honda",
                "model": "Pilot",
                "year": 2021,
                "price": 37000,
                "sale_date": "2023-02-20",
                "region": "East"
            },
            {
                "manufacturer": "Nissan",
                "model": "Altima",
                "year": 2020,
                "price": 24000,
                "sale_date": "2023-03-17",
                "region": "North"
            },
            {
                "manufacturer": "Nissan",
                "model": "Sentra",
                "year": 2021,
                "price": 19000,
                "sale_date": "2023-04-09",
                "region": "South"
            },
            {
                "manufacturer": "Nissan",
                "model": "Rogue",
                "year": 2022,
                "price": 31000,
                "sale_date": "2023-05-25",
                "region": "West"
            },
            {
                "manufacturer": "Nissan",
                "model": "Murano",
                "year": 2021,
                "price": 36000,
                "sale_date": "2023-06-11",
                "region": "East"
            },
            {
                "manufacturer": "Chevrolet",
                "model": "Malibu",
                "year": 2020,
                "price": 23000,
                "sale_date": "2023-07-22",
                "region": "North"
            },
            {
                "manufacturer": "Chevrolet",
                "model": "Cruze",
                "year": 2019,
                "price": 18000,
                "sale_date": "2023-08-07",
                "region": "South"
            },
            {
                "manufacturer": "Chevrolet",
                "model": "Equinox",
                "year": 2021,
                "price": 29000,
                "sale_date": "2023-09-13",
                "region": "West"
            },
            {
                "manufacturer": "Chevrolet",
                "model": "Tahoe",
                "year": 2022,
                "price": 52000,
                "sale_date": "2023-10-01",
                "region": "East"
            },
            {
                "manufacturer": "BMW",
                "model": "3 Series",
                "year": 2021,
                "price": 45000,
                "sale_date": "2023-11-18",
                "region": "North"
            },
            {
                "manufacturer": "BMW",
                "model": "X3",
                "year": 2022,
                "price": 55000,
                "sale_date": "2023-12-15",
                "region": "South"
            }
        ];

        const embedPromise = new Promise((resolve, reject) => {
            const embedIframe = document.createElement('iframe');
            embedIframe.style.height = '700px';
            embedIframe.style.width = 'calc(100% - 4px)';
            document.body.appendChild(embedIframe);

            // Prepare the HTML content with the script tag.
            const closeScriptTag = '</'+'script>';
            const htmlContent = `
<!DOCTYPE html>
<html>
<body>
    <div id="root"></div>
    <script src="../py-src/data_formulator/dist/DataFormulator.js" defer onload="console.log('my loc'+document.location);parent.frameLoaded()" onerror="parent.frameError()">${closeScriptTag}
</body>
</html>
`;

            // Define global functions for onload and onerror events of the script
            window.frameLoaded = () => resolve(embedIframe);
            window.frameError = () => reject(new Error('Script failed to load'));

            // Write the HTML content to the iframe
            embedIframe.contentWindow.document.open();
            embedIframe.contentWindow.document.write(htmlContent);
            embedIframe.contentWindow.document.close();
        });
        embedPromise.then((embedIframe) => {
            embedIframe.contentWindow.postMessage({ actionName: 'setConfig', actionParams: { serverUrl: 'http://localhost:5000' } }, '*');
            embedIframe.contentWindow.postMessage({ actionName: 'loadData', actionParams: { tableName: 'FabricTable', table } }, '*');
        });

    </script>
</body>

</html>